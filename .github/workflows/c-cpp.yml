name: C/C++ CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install Valgrind
      run: sudo apt-get install -y valgrind

    - name: Build and Test 6lab
      run: |
        cd 6lab
        make
        
    - name: Check for Memory Leaks
      run: |
        cd 6lab
        valgrind --leak-check=full --error-exitcode=1 ./main
  
    - name: Build and Test 7lab
      run: |
        cd 7lab
        make
    - name: Run automated tests
      run: |
        cd 7lab
        echo -e "1\n5\n10\n5\n5" | ./main || true  

    - name: Build and Test 8lab
      run: |
        cd 8lab
        make

    - name: Run automated tests
      run: |
        cd 8lab
        echo -e "1\n5\n10\n5\n5" | ./calcul || true 

    - name: Build and Test 9lab/1ex
      run: |
        cd 9lab/1ex
        make
    
    - name: Build and Test 9lab/1ex
      run: |
        cd 9lab/2ex
        make
        echo -e "q\n" | ./test || true